<!Doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <title>米乐弗-创建演讲</title>
    <link rel="stylesheet" href="../../css/common/normalize.css">
    <link rel="stylesheet" href="../../css/common/common.css">
    <link rel="stylesheet" href="../../css/common/pagination.css">
    <link rel="stylesheet" href="../../js/lib/ueditor/themes/default/css/umeditor.css">
    <link rel="stylesheet" href="../../css/page/pc/create.css">
</head>
<body>
<div id="header"></div>
<div class="contbox ">
    <div class="title">
        <span class="triangle triangle-left"></span><span>创建演讲</span><span class="triangle triangle-right"></span>
    </div>
    <div class="formbox clearfix">
        <div class="head-pic fl">
            <form enctype="multipart/form-data" id="uploadImg" method="post" action="">
                <a href="javascript:;" class="a-upload">
                    <img src="../../img/pc/upload-default.png" alt="">
                    <input name="imgFile" type="file" accept="image/png,image/gif,image/jpg,image/jpeg,image/bmp"/>
                    <span>点击上传演讲图片</span>
                </a>
            </form>
        </div>
        <form class="createForm fl" id="createForm" method="get" action="">
            <div class="left fl">
                <p>
                    <label for="title">演讲标题</label>
                    <input id="title" name="title" type="text" placeholder="必填">
                </p>
                <p>
                    <label for="uname">演 讲 人</label>
                    <input class="name" id="uname" name="uname" type="text" placeholder="必填">
                    <a class="createPeopleBtn" href="./createPeople.html">创建新人物</a>
                </p>
                <p>
                    <style>
                        .createForm .views{
                            width: 55px;
                        }
                    </style>
                    <label for="view">演讲观点</label>
                    <input class="views js-mark-list" id="view" name="view" type="text" placeholder="观点一">
                    <input class="views js-mark-list" name="view" type="text" placeholder="观点二">
                    <input class="views js-mark-list" name="view" type="text" placeholder="观点三">
                </p>
                <p>
                    <label>三句摘要</label>
                    <input name="summary1" type="text"><br>
                    <input name="summary2" type="text" style="margin-left: 84px;"><br>
                    <input name="summary3" type="text" style="margin-left: 84px;">
                </p>
                <ul class="peomark-list">
                    <li>a</li>
                    <li>小明</li>
                    <li>小明</li>
                    <li>小明</li>
                    <li>小明</li>
                    <li>小明</li>
                </ul>
            </div>
            <div class="right fl">
                <p>
                    <label for="subtitle">演讲副标题</label>
                    <input id="subtitle" name="subtitle" type="text">
                </p>
                <p>
                    <label for="addr">演讲地点</label>
                    <input id="addr" name="addr" type="text">
                </p>

                <p>
                    <label for="time">演讲时间</label>
                    <input id="time" name="time" type="text" placeholder="必填">
                </p>
                <p>
                    <label for="sponsor">主 办 方</label>
                    <input id="sponsor" name="sponsor" type="text">
                </p>
            </div>
        </form>
    </div>
    <div class="create-main">
        <div class="cont">
            <h4 class="c-title">演讲正文</h4>

            <div id="myEditor"></div>
            <div class="submitbox clearfix">
                <div class="codebox fl">
                    <img class="imgcode" src="http://106.75.72.156/api/getcaptcha?type=celebrity" alt="">
                    <input class="codeipt" type="text" placeholder="验证码">
                    <a class="submitBtn js-submit" href="javascript:;">提交审核</a>
                </div>
            </div>
        </div>

    </div>
</div>
<div id="footer"></div>

<script type="text/javascript" src="../../js/lib/jquery.min.js"></script>
<script type="text/javascript" src="../../js/lib/jquery.validate.min.js"></script>
<script type="text/javascript" src="../../js/lib/jquery.form.min.js"></script>
<script type="text/javascript" src="../../js/lib/ueditor/umeditor.config.js"></script>
<script type="text/javascript" src="../../js/lib/ueditor/umeditor.min.js"></script>
<script type="text/javascript" src="../../js/lib/ueditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" src="../../js/base.js"></script>
<script type="text/javascript" src="../../js/page/pc/create.js"></script>
<script>
    jQuery(function ($) {
        //实例化编辑器
        var um = UM.getEditor('myEditor');
        //上传文件
        $('.a-upload input').change(function () {
            $("#uploadImg").ajaxSubmit({
                url: '/api/uploadimg',
                data: {
                    type: 'lecture'
                },
                type: "POST",
                success: function (retData) {
                    if (retData.errno == 0) {
                        $('.a-upload img').attr('src', retData.data);
                        $('.a-upload span').html('');
                    } else {
                        alert('上传出错')
                    }
                },
                error: function (msg) {
                    alert("出错了");
                }
            });
        });

        //观点选择
        var $iptPeoMark = $('.js-mark-list'),
            $peomarkList = $('.peomark-list'),
            $curIpt = null;

        $iptPeoMark.focus(function () {
            $curIpt = $(this);
            $peomarkList.css('top', $curIpt.offset().top + $curIpt.height() + 2 - $('#createForm').offset().top).show();
        }).blur(function () {
            $peomarkList.hide(200);
        }).keyup(function (e) {
            $peomarkList.find('li').show();
            $peomarkList.find('li:not(:contains("' + $(this).val() + '"))').hide();
        }).click(function () {
            return false;
        });
        $peomarkList.on('click', 'li', function () {
            var $this = $(this);
            $curIpt.val($this.html()).data('markid', $this.data('markid'));
            $peomarkList.hide();
            return false;
        });
        $(document).click(function () {
            $peomarkList.fadeOut();
        });

        //表单验证
        $('.createForm').validate({
            submitHandler: function (form) {
                var lables = [];
                $('.js-peomark-list').each(function () {
                    if ($(this).data('markid')) {
                        lables.push($(this).data('markid'))
                    }
                });

                if ($('.a-upload img').attr('src').indexOf('upload-default.png') > -1) {
                    alert('请上传用户图片');
                    return false;
                }
                var data = $.extend({}, {
                    avatar: $('.a-upload img').attr('src'),
                    birthplace: $('.prov option:selected').html() + ' ' + $('.city option:selected').html(),
                    labels: lables.join(','),
                    captcha: $('.codeipt').val(),
                    intro: um.getContent()
                }, $('#createForm').serializeJson());

                console.log(data);

                $.post('api/submitcelebrity', data, function (retData) {
                    if (retData.errno == 0) {
                        location.href = './mycreate.html';
                    } else {
                        alert(retData.errmsg)
                    }
                });
            },
            errorElement: 'i',
            rules: {
                nameCn: 'required',
                birthday: 'required'
            },
            messages: {
                nameCn: '*',
                birthday: '*'
            }
        });

        //提交
        $('.js-submit').click(function () {
            $('.createForm').submit()
        });
    })
</script>
</body>
</html>